"use strict";define(["jquery","knockout","bootstrap","app","global","knockoutValidation","setphone","tfa"],function(e,o,n,a,t){return o.validation.rules.phoneEmailValidation={validator:function(){return!1!==a.validateLogin()},message:"Lütfen geçerli bir cep telefonu veya e-posta adresi giriniz."},o.validation.init({registerExtenders:!0,messagesOnModified:!0,insertMessages:!0,parseInputAttributes:!0,messageTemplate:null},!0),function(){var n=this;n.phoneEmailValidation=o.observable(!0),n.loginType=o.observable(0),n.loginTypeShow=!1,n.loginTypeShow=function(){return n.validationEnabled},n.PhoneMail=o.observable().extend({required:{message:"Lütfen cep telefonu veya e-posta adres alanını kontrol ediniz."},minLength:{params:6,message:"Lütfen cep telefonu veya e-posta adres alanını kontrol ediniz."},phoneEmailValidation:n.phoneEmailValidation}),n.Password=o.observable(),n.ReCaptchaToken=o.observable(null),n.TfaToken=o.observable(null),n.TfaTokenShow=o.observable(null),n.SetMobileToken=o.observable(null),n.ChangePass=o.observable(null),n.Error=o.observable(null),n.LoginType=o.observable(null),n.PhoneCode=o.observable(null),n.EnabledButton=o.observable(!0),n.MembershipButtonVisible=o.observable(!0),n.InputErrors=o.validation.group(n),n.ClearError=function(){n.Error(null)},n.GenerateCaptcha=function(){a.reCaptcha()},n.isMembership=o.observable(null),n.SocialRegister=o.observable(!1),n.SocialAccessToken=o.observable(),n.SocialsignUpMethod=o.observable(),a.facebookModel(n),n.HumanVerificationToken=o.observable(),n.dialCodeControl=o.observable(null),n.LoginControl=function(){return a.loading(),null!==n.isMembership()&&""===grecaptcha.getResponse()?(a.recaptchaClickLb(),void a.loadingRemove()):null!==n.isMembership()?(n.Login(),void a.loadingRemove()):(n.EnabledButton(!1),0!==n.InputErrors().length?(n.InputErrors.showAllMessages(),n.EnabledButton(!0),void a.loadingRemove()):(n.Error(null),n.LoginType(a.validateLogin()),void("mobile"===n.LoginType()?e.ajax({async:!1,method:"POST",url:window.apiEndpoint+"/validate/phone",data:o.toJSON({phoneNumber:n.PhoneMail(),locale:a.country(),platform:0}),contentType:"application/json; charset=utf-8",dataType:"json",crossDomain:!0,processData:!0,success:function(o){a.loadingRemove(),null!==o.data?(n.dialCodeControl(o.data),""!==grecaptcha.getResponse()&&e("#submitBtn").trigger("click"),a.recaptchaClickLb()):(n.Error(o.error.message),n.EnabledButton(!0),grecaptcha.reset())}}):(""!==grecaptcha.getResponse()&&e("#submitBtn").trigger("click"),a.recaptchaClickLb()))))},n.Login=function(){if(0!==n.InputErrors().length)return n.InputErrors.showAllMessages(),void n.EnabledButton(!0);n.Error(null),a.loading(),n.EnabledButton(!1),null!==n.isMembership()?(n.HumanVerificationToken(grecaptcha.getResponse()),"mobile"===n.LoginType()?e.ajax({method:"POST",url:window.apiEndpoint+"/user/login/phone",data:o.toJSON({PhoneNumber:n.dialCodeControl(),Password:n.Password(),Platform:"0",HumanVerificationToken:n.HumanVerificationToken()}),contentType:"application/json; charset=utf-8",dataType:"json",crossDomain:!0,processData:!0,success:function(e){e.succeeded?"SetPhone"!==e.data.tokenType?(n.TfaToken(e.data.access_token),n.TfaTokenShow(e.data.access_token)):n.SetMobileToken(e.data.access_token):(n.Error(e.error.message),n.EnabledButton(!0),grecaptcha.reset()),a.loadingRemove()},error:function(e){a.errorLb(),n.EnabledButton(!0),a.loadingRemove(),pushLog(JSON.stringify({PhoneNumber:n.dialCodeControl(),Platform:"0",HumanVerificationToken:n.HumanVerificationToken()}),"errorTypeLoginPhone",e.statusText,"-","-","-")}}):"email"===n.LoginType()&&e.ajax({method:"POST",url:window.apiEndpoint+"/user/login/email",data:o.toJSON({Email:n.PhoneMail().toLowerCase(),Password:n.Password(),Platform:"0",HumanVerificationToken:n.HumanVerificationToken()}),contentType:"application/json; charset=utf-8",dataType:"json",crossDomain:!0,processData:!0,success:function(e){e.succeeded?"SetPhone"!==e.data.tokenType?(n.TfaToken(e.data.access_token),n.TfaTokenShow(e.data.access_token)):n.SetMobileToken(e.data.access_token):(n.Error(e.error.message),n.EnabledButton(!0),grecaptcha.reset()),a.loadingRemove()},error:function(e){a.errorLb(),n.EnabledButton(!0),a.loadingRemove(),pushLog(JSON.stringify({Email:n.PhoneMail().toLowerCase(),Platform:"0",HumanVerificationToken:n.HumanVerificationToken()}),"errorTypeLoginEmail",e.statusText,"-","-","-")}})):n.Membership()},n.Membership=function(){n.Error(null),n.Password.extend({required:{message:"Lütfen şifre alanını doldurunuz.",onlyIf:function(){return null!==n.isMembership()}},minLength:{params:6,message:"Şifre alanı en az 6 haneli olmalıdır."}}),a.loading(),n.EnabledButton(!1),n.HumanVerificationToken(grecaptcha.getResponse()),"mobile"===n.LoginType()?e.ajax({method:"POST",url:window.apiEndpoint+"/Membership/validate/phone",data:o.toJSON({phoneNumber:n.dialCodeControl(),locale:a.country(),platform:"0",humanVerificationToken:n.HumanVerificationToken()}),contentType:"application/json; charset=utf-8",dataType:"json",crossDomain:!0,processData:!0,success:function(o){o.succeeded?(t.membershipPhone(n.dialCodeControl()),n.isMembership(!1)):341===o.error.code?(e(".password").removeClass("hide"),e("#login-button").removeClass("hide"),setTimeout(function(){e(".password input").focus()},400),n.isMembership(!0),n.MembershipButtonVisible(!1)):n.Error(o.error.message),n.EnabledButton(!0),a.loadingRemove()},error:function(e){a.errorLb(),n.EnabledButton(!0),a.loadingRemove()}}):"email"===n.LoginType()&&e.ajax({method:"POST",url:window.apiEndpoint+"/Membership/validate/email",data:o.toJSON({email:n.PhoneMail(),locale:a.country(),platform:"0",humanVerificationToken:n.HumanVerificationToken()}),contentType:"application/json; charset=utf-8",dataType:"json",crossDomain:!0,processData:!0,success:function(o){o.succeeded?(t.membershipEmail(n.PhoneMail()),n.isMembership(!1)):340===o.error.code?(e(".password").removeClass("hide"),e("#login-button").removeClass("hide"),setTimeout(function(){e(".password input").focus()},400),n.isMembership(!0),n.MembershipButtonVisible(!1)):n.Error(o.error.message),n.EnabledButton(!0),a.loadingRemove()},error:function(e){a.errorLb(),n.EnabledButton(!0),a.loadingRemove()}})},n.GoogleClick=function(){e("#glogin *").click()},n.ToggleGoogleButton=function(){a.clickedGoogleButton(!0)},a.googleSignResponse.subscribe(function(i){var r=i.getAuthResponse().id_token,s=i.getId();e.ajax({method:"POST",url:window.apiEndpoint+"/membership/validate/userId",data:o.toJSON({userId:s,signUpMethod:2,platform:0}),contentType:"application/json; charset=utf-8",dataType:"json",crossDomain:!0,processData:!0,success:function(i){i.succeeded&&(i.data?e.ajax({method:"POST",url:window.apiEndpoint+"user/social/login",data:o.toJSON({accessToken:r,platform:"0",method:"2",signUpReferenceCode:t.paparaRefId(),additionalData:{}}),contentType:"application/json; charset=utf-8",dataType:"json",crossDomain:!0,processData:!0,success:function(e){e.succeeded?"SetPhone"!==e.data.tokenType?(n.TfaToken(e.data.access_token),n.TfaTokenShow(e.data.access_token)):n.SetMobileToken(e.data.access_token):(n.Error(e.error.message),n.EnabledButton(!0)),a.clickedGoogleButton(!1),a.loadingRemove()},error:function(e){a.errorLb(),n.EnabledButton(!0),a.loadingRemove()}}):(n.isMembership(!1),n.SocialRegister(!0),n.SocialAccessToken(r),n.SocialsignUpMethod(2))),globalPapara.loadingRemove()}})}),a.Init(),a.mobilSmart(),a.toggleMenuRemove(),a.loadHtml(),a.loadingRemove(),a.scrollAndInputCon(),a.facebookLoginInit("tr_TR"),e(window).bind("load",function(){a.firstLoadRemove()}),n.RenderButton=function(){e("head").append('<script src="https://apis.google.com/js/platform.js?onload=loadGoogleLogin" async defer id="googleJs"><\/script>')},e(".login-back").on("click",function(){e(".RegisterComplete").is(":visible")||(n.MembershipButtonVisible(!0),n.SocialRegister(!1),n.isMembership(null),n.Error(null),n.EnabledButton(!0),n.SetMobileToken(null),n.TfaTokenShow()&&(n.TfaTokenShow(null),a.reCaptcha()),setTimeout(function(){a.inputFocus()},300),n.Password(""),FB.getAccessToken()&&FB.logout(),a.reCaptcha())}),n.FacebookLogin=function(){FB.getAccessToken()?a.facebookLoginAction():FB.login(function(e){a.facebookLoginAction()},{scope:"email"})}}});