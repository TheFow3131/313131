"use strict";var globalPapara,Clipboard;define(["jquery","knockout","sammy","app","moment","global","clipboard","store","login","login-ctrl","register","register-complete","deposit","withdrawMoney","moneyTransfer","pocketMoney","dashboard","creditCard","account","account-information","bankAccounts","transactionHistory","settings","eduStudent","jquery-ui","jcookie","text","forgot-password","reset-password","change-password","edu","bootstrap","papara-card","hammer","string","bill-payment","desk","faq-pages","app-footer","cashback-dashboard","exchange","exchange-buy","exchange-sell","crypto","crypto-deposit","crypto-withdrawal","crypto-pending","cashback-app","currency","currency-deposit","currency-withdrawal","currency-pendings","paparacard-split","commercial-account"],function(e,r,o,a,t,s,n,i){r.applyBindings(new function(){globalPapara=a,t.locale("tr"),a.firstLoad(),Clipboard=n;var c=this;if(c.IsUserLogin=r.observable(void 0!==e.cookie("auth-papara")),c.CurrentPage=r.observable(""),c.PictureUrl=r.observable(s.pictureUrl()),s.pictureUrl.subscribe(function(e){c.PictureUrl(e)}),c.Resources=r.observable(),c.Pages=r.observableArray(),c.DefaultPage=r.observable(!0===c.IsUserLogin()?"/personal/#!/dashboard":"/personal/#!/login"),c.RedirectUrl=r.observable(),c.EmailConfirmationMessage=r.observable(),c.CompParams=r.observable(null),c.pageComp=r.observable(null),c.AccountNumber=r.observable(),c.FailedLoginPlatform=r.observable(),c.FailedLoginMethod=r.observable(),c.FailedLoginDate=r.observable(),c.UserFirstName=r.observable(),c.FailedLoginIP=r.observable(),c.FirstLoadedPage=r.observable(!0),c.ViewingAuthority=r.observable(!1),c.User=r.observable(),c.EduStatus=r.observable(s.showEduPageIndex()),c.isCrypto=r.observable(!1),c.isCurrency=r.observable(!1),s.showEduPageIndex.subscribe(function(e){c.EduStatus(e)}),c.ErrorAddCurrency=r.observable(null),s.ErrorAddCurrency.subscribe(function(e){c.ErrorAddCurrency(e)}),c.SuccessAddCurrency=r.observable(null),s.SuccessAddCurrency.subscribe(function(e){c.SuccessAddCurrency(e)}),c.GetAccountNumber=function(){e.ajax({method:"GET",url:window.apiEndpoint+"user/accountnumber",dataType:"json",crossDomain:!0,processData:!0,xhrFields:{withCredentials:!0},success:function(e){!0===e.succeeded&&c.AccountNumber(e.data)}})},c.GetNotificationStatus=function(){e.ajax({method:"GET",url:window.apiEndpoint+"user/marketingpermission",dataType:"json",crossDomain:!0,processData:!0,xhrFields:{withCredentials:!0},success:function(r){!0===r.succeeded&&(null!==r.data&&""!==r.data||e("#campaign-lb").modal())}})},c.CheckFailLogin=function(){"true"!==e.cookie("checkFailLogin")&&e.ajax({url:window.apiEndpoint+"user/lastfaillogin",dataType:"json",crossDomain:!0,processData:!0,xhrFields:{withCredentials:!0},success:function(r){if(!0===r.succeeded){switch(e.cookie("checkFailLogin","true"),r.data.platform){case 0:c.FailedLoginPlatform("Web");break;case 1:c.FailedLoginPlatform("İOS");break;case 2:c.FailedLoginPlatform("ANDROİD")}c.FailedLoginDate(t(r.data.createdAt).format("lll")),c.FailedLoginIP(r.data.ip),c.FailedLoginMethod(0===r.data.loginMethod?"Şifre":"PIN"),e("#loginLog").modal(),e("body").addClass("modal-open")}}})},c.SessionModalDisable=r.observable(!1),c.SessionAgent=function(){e.ajax({method:"GET",url:"/personal/sessiontime",dataType:"json",crossDomain:!0,processData:!0,success:function(r){var o=r,a=setInterval(function(){void 0===e.cookie("auth-papara")?(clearInterval(a),i.remove("pUrl"),i.remove("fllName"),i.remove("fName"),window.location.reload()):(o<=90&&!1===c.SessionModalDisable()&&(o<10?e("#sessionCountDown").html("0"+o):e("#sessionCountDown").html(o),e("#slideSessionModal").is(":visible")||e("#slideSessionModal").modal({backdrop:"static"})),o--)},1e3)}})},c.RefreshToken=function(){e.ajax({method:"GET",url:window.apiEndpoint+"user/refreshtoken",dataType:"json",crossDomain:!0,processData:!0,xhrFields:{withCredentials:!0},success:function(e){window.location.reload()}})},void 0!==e.cookie("auth-papara")&&(c.CheckFailLogin(),c.SessionAgent()),!0===c.IsUserLogin()){c.GetAccountNumber(),c.GetNotificationStatus();var u=s.getUser();void 0!==u&&(c.ViewingAuthority(u.data.betaFeaturesEnabled),c.User(u),c.UserFirstName(u.data.firstName))}c.LogOut=function(){a.loading(),dataLayer.push({Category:"Üyelik",Action:"Güvenli Çıkış",Label:"Güvenli Çıkış Click",event:"gaEvent"}),i.remove("pUrl"),i.remove("fllName"),i.remove("fName"),i.remove("store"),jsSessionStorage.removeItem("store"),e.ajax({method:"GET",url:window.apiEndpoint+"user/logout",crossDomain:!0,processData:!0,xhrFields:{withCredentials:!0},success:function(e){a.loadingRemove()},error:function(){a.loadingRemove()}})},c.GetPagesItem=function(e){return void 0===c.Pages()?"":c.Pages()[e()][Object.keys(c.Pages()[e()])]},c.redirectReturnUrl=function(e){var r=e.split("/"),o=r[2]||r[0];/(^|\.)papara\.com$/.test(o)?s.redirectUrl(e):s.redirectUrl("https://www.papara.com/")},c.PaparaSammy=function(){o(function(){this.get("#!/:view",function(){if(a.loading(),c.CompParams(null),!0===c.IsUserLogin()){e.cookie("cd_user_id",c.AccountNumber());var o=new Date,t=o.getMonth()+1;t<10&&(t="0"+t);var s=o.getDate()+"."+t+"."+o.getFullYear();e.cookie("cd_user_signup_date",s)}else e.cookie("cd_user_id",null,{expires:-1}),e.cookie("cd_user_signup_date",null,{expires:-1});a.customDimension(),c.DefaultPage(!0===c.IsUserLogin()?"/personal/#!/dashboard":"/personal/#!/login");var n,i=this,u=i.params.view;c.IsUserLogin(void 0!==e.cookie("auth-papara"));var l={};window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(e,r,o){l[r]=o}),void 0!==l.sig&&void 0!==l.sso&&(e.cookie("ssoUrlSig",l.sig),e.cookie("ssoUrlSso",l.sso)),c.ssoUrlSso=r.observable(e.cookie("ssoUrlSso")),c.ssoUrlSig=r.observable(e.cookie("ssoUrlSig")),c.IsUserLogin()&&void 0!==c.ssoUrlSig()&&void 0!==c.ssoUrlSso()&&e.ajax(window.apiEndpoint+"user/sso",{data:r.toJSON({sso:c.ssoUrlSso(),sig:c.ssoUrlSig()}),type:"post",contentType:"application/json; charset=utf-8",dataType:"json",crossDomain:!0,processData:!0,xhrFields:{withCredentials:!0},success:function(r){!0===r.succeeded?window.location.href=r.data:(e("#ssoMessage").text(r.error.message),e("#ssoError").modal()),e.removeCookie("ssoUrlSig"),e.removeCookie("ssoUrlSso")}});var p=0;e.each(c.Pages(),function(r,o){Object.keys(o)[0]===u?(o[u].pageComp?c.pageComp(o[u].pageComp):c.pageComp(null),o[u].requireAuth&&!c.IsUserLogin()?n="login-comp":(c.IsUserLogin()&&"login-comp"===o[u].compName||c.IsUserLogin()&&"register-comp"===o[u].compName?(n="dashboard-comp",i.redirect(c.DefaultPage())):(delete insider_object.transaction,e.extend(insider_object,{product:{name:o[u].title}}),n=o[u].compName),void 0!==o[u].isBetaFeature&&!c.ViewingAuthority()&&c.IsUserLogin()&&(n="dashboard-comp"))):p++}),c.Pages().length===p&&(window.location="/Errors/404.html"),c.CurrentPage()!==n?(a.firstLoadRemove(),c.CurrentPage(n)):a.loadingRemove()}),this.get("/personal/#!/emailconfirmation/(.*)",function(){var o=this.params.splat[0].replace(new RegExp(" ","g"),"+"),a=o.split("&")[0],t=o.split("&")[1],n=this;e.ajax({method:"PUT",url:window.apiEndpoint+"user/emailconfirmation",data:r.toJSON({userId:a,code:t}),contentType:"application/json; charset=utf-8",dataType:"json",crossDomain:!0,processData:!0,async:!1,success:function(r){c.CurrentPage(!0===c.IsUserLogin()?"dashboard-comp":"login-comp"),n.redirect(!0===c.IsUserLogin()?"/personal/#!/dashboard":"/personal/#!/login"),e("#emailConfirmModal").modal("show");var o=s.getUser();void 0!==o&&c.User(o),r.succeeded?c.EmailConfirmationMessage(r.data):c.EmailConfirmationMessage(r.error.message)}})}),this.get("/personal/#!/v2/resetpassword/(.*)",function(){var e=this.params.splat[0].replace(new RegExp(" ","g"),"+"),r=e.split("&")[0],o=e.split("&")[1];c.CompParams({userId:r,code:o}),c.CurrentPage("resetpass-comp")}),this.get("/personal/#!",function(){void 0!==this.params.ReturnUrl&&c.redirectReturnUrl(this.params.ReturnUrl),c.CurrentPage(!0===c.IsUserLogin()?"dashboard-comp":"login-comp")}),this.get("/personal/#!/",function(){void 0!==this.params.ReturnUrl&&c.redirectReturnUrl(this.params.ReturnUrl),c.CurrentPage(!0===c.IsUserLogin()?"dashboard-comp":"login-comp")}),this.get("/personal",function(){void 0!==this.params.ReturnUrl&&c.redirectReturnUrl(this.params.ReturnUrl),c.CurrentPage(!0===c.IsUserLogin()?"dashboard-comp":"login-comp")}),this.get("/personal/#!/dashboard/success",function(){c.CurrentPage("dashboard-comp")}),this.get("/personal/#!/deposit-money/error/(.*)",function(){var e=this.params.splat[0];e.split("/")[0],e.split("/")[1],c.CurrentPage("deposit-comp")}),this.get("personal/#!/papara-card/add",function(){c.CompParams({status:"add"}),c.CurrentPage("papara-card-comp")}),this.get("personal/#!/papara-card/lost",function(){c.CompParams({status:"lost"}),c.CurrentPage("papara-card-comp")}),this.get("personal/#!/pocket-money/success",function(){c.CompParams({status:"success"}),c.CurrentPage("pocketmoney-comp")}),this.get("personal/#!/pocket-money/error(.*)",function(){var e=this.params.splat[0].split("/")[1];c.CompParams({status:"error",statusMessage:e}),c.CurrentPage("pocketmoney-comp")}),this.get("personal/#!/pocket-money/add",function(){c.CompParams({status:"add"}),c.CurrentPage("pocketmoney-comp")}),this.get("checkout/*/success",function(){c.CompParams({status:"success"}),c.CurrentPage("checkout-comp")}),this.get("checkout/*/error(.*)",function(){var e=this.params.splat[0].split("/")[1];c.CompParams({status:"error",statusMessage:e}),c.CurrentPage("checkout-comp")}),this.get("personal/#!/credit-cards/success",function(){c.CompParams({status:"success"}),c.CurrentPage("creditcard-comp")}),this.get("personal/#!/credit-cards/error(.*)",function(){var e=this.params.splat[0].split("/")[1];c.CompParams({status:"error",statusMessage:e}),c.CurrentPage("creditcard-comp")}),this.get("personal(.*)/money-transfer/send-money",function(){c.CompParams({status:"sendMoney"}),c.CurrentPage("moneytransfer-comp")}),this.get("personal(.*)/money-transfer/request-money",function(){c.CompParams({status:"requestMoney"}),c.CurrentPage("moneytransfer-comp")}),this.get("personal(.*)/split/request-money",function(){c.CompParams({status:"requestMoney"}),c.CurrentPage("paparacard-split-comp")}),this.get("personal(.*)/transaction-history/papara-card",function(){c.CompParams({status:"papara-card"}),c.CurrentPage("transactionhistory-comp")}),this.get("/personal/",function(){void 0!==this.params.ReturnUrl&&c.redirectReturnUrl(this.params.ReturnUrl),c.CurrentPage(!0===c.IsUserLogin()?"dashboard-comp":"login-comp")}),this.get("/login/",function(){if(void 0!==this.params.ReturnUrl){var e=this.params.ReturnUrl;if(c.redirectReturnUrl(e),c.IsUserLogin()){var r=e.split("/"),o=r[2]||r[0];/(^|\.)papara\.com$/.test(o)?window.location.href=e:s.redirectUrl("https://www.papara.com/")}else c.CurrentPage("login-comp")}else window.location.href="/personal/#!/dashboard"})}).run()},c.CheckResourceThenFillPages=function(){if(jsSessionStorage.removeItem("resourceOutSide"),s.setStorageExpireDate(),jsSessionStorage.getItem("storageExpireDate")&&jsSessionStorage.getItem("resourceInSide")){var r=JSON.parse(jsSessionStorage.getItem("resourceInSide"));c.Resources(r),c.SetPages(r),c.PaparaSammy(),s.resource(c.Resources())}else jsSessionStorage.removeItem("resourceInSide"),e.ajax(window.apiEndpoint+"resource/list",{type:"get",async:!1,cache:!0,success:function(e){c.Resources(e),c.SetPages(e),c.PaparaSammy(),s.resource(c.Resources()),jsSessionStorage.setItem("resourceInSide",JSON.stringify(e)),s.setStorageExpireDate()}})},c.SendMoneyPendingCount=r.observable(s.moneyRequestsTotalRequest()),s.moneyRequestsTotalRequest.subscribe(function(){c.SendMoneyPendingCount(s.moneyRequestsTotalRequest())}),c.WithdrawalPendingRequests=r.observable(s.withdrawalPendingRequests().length),s.withdrawalPendingRequests.subscribe(function(){c.WithdrawalPendingRequests(s.withdrawalPendingRequests().length)}),c.UnpaidBillsCount=r.observable(s.unpaidBillsCount()),s.unpaidBillsCount.subscribe(function(){c.UnpaidBillsCount(s.unpaidBillsCount())}),s.selectedCurrency.subscribe(function(e){c.isCrypto(e.isCryptocurrency),e.isCryptocurrency?c.isCurrency(!1):c.isCurrency(e.currencyEnum!==s.userCurrency().currencyEnum)}),c.SetPages=function(e){c.Pages([{login:{compName:"login-comp",title:e.menu_Login,url:"!/login",requireAuth:!1,isMenuItem:!1}},{register:{compName:"login-comp",title:e.menu_Register,url:"!/register",requireAuth:!1,isMenuItem:!1}},{dashboard:{compName:"dashboard-comp",title:e.menu_Dashboard,url:"!/dashboard",requireAuth:!0,isMenuItem:!1}},{"money-transfer":{compName:"moneytransfer-comp",title:e.menu_SendMoney,url:"!/money-transfer",requireAuth:!0,isMenuItem:!0,pending:"SendMoneyPendingCount"}},{"deposit-money":{compName:"deposit-comp",title:e.menu_DepositMoney,url:"!/deposit-money",requireAuth:!0,isMenuItem:!0,isCryptoHide:!0,isCurrencyHide:!0}},{"withdraw-money":{compName:"withdrawmoney-comp",title:e.menu_WithdrawMoney,url:"!/withdraw-money",requireAuth:!0,isMenuItem:!0,pending:"WithdrawalPendingRequests",isCryptoHide:!0,isCurrencyHide:!0}},{crypto:{compName:"crypto-comp",title:"Çek / Yatır",url:"!/crypto",requireAuth:!0,isMenuItem:!0,isCryptoHide:!1,isCurrencyHide:!0}},{currency:{compName:"currency-comp",title:"Para Çek / Yatır",url:"!/currency",requireAuth:!0,isMenuItem:!0,isCryptoHide:!0,isCurrencyHide:!1,pending:"WithdrawalPendingRequests"}},{"currency-withdrawal":{compName:"currency-comp",title:"Çek",url:"!/currency-withdrawal",requireAuth:!0,isMenuItem:!1,pageComp:["currency-withdrawal-comp",0]}},{"currency-deposit":{compName:"currency-comp",title:"Yatır",url:"!/currency-deposit",requireAuth:!0,isMenuItem:!1,pageComp:["currency-deposit-comp",1]}},{"currency-pendings":{compName:"currency-comp",title:"Yatır",url:"!/currency-pendings",requireAuth:!0,isMenuItem:!1,pageComp:["currency-pendings-comp",2]}},{exchange:{compName:"exchange-comp",title:"Döviz Alış / Satış",url:"!/exchange",requireAuth:!0,isMenuItem:!0,isCryptoHide:!0,isCurrencyHide:!1}},{"exchange-buy":{compName:"exchange-comp",title:"Döviz Alış",url:"!/exchange-buy",requireAuth:!0,isMenuItem:!1,pageComp:["exchange-buy-comp",0]}},{"exchange-sell":{compName:"exchange-comp",title:"Döviz Satış",url:"!/exchange-sell",requireAuth:!0,isMenuItem:!1,pageComp:["exchange-sell-comp",1]}},{exchange:{compName:"exchange-comp",title:"Döviz Alış / Satış",url:"!/exchange",requireAuth:!0,isMenuItem:!0,isCryptoHide:!1,isCurrencyHide:!0}},{"bill-payment":{compName:"bill-payment-comp",title:e.menu_BillsPayment,url:"!/bill-payment",requireAuth:!0,isMenuItem:!0,pending:"UnpaidBillsCount"}},{"papara-card":{compName:"papara-card-comp",title:e.menu_PaparaCard,url:"!/papara-card",requireAuth:!0,isMenuItem:!0}},{"edu-student":{compName:"edustudent-comp",title:e.menu_PocketMoney,url:"!/edu-student",requireAuth:!0,isMenuItem:!0,eduPageIndex:0}},{"pocket-money":{compName:"pocketmoney-comp",title:e.menu_PocketMoney,url:"!/pocket-money",requireAuth:!0,isMenuItem:!0,eduPageIndex:1}},{"edu-card":{compName:"edu-comp",title:e.menu_PocketMoney,url:"!/edu-card",requireAuth:!0,isMenuItem:!0,eduPageIndex:2}},{cashback:{compName:"cashback-app-comp",title:e.menu_CashBack,url:"!/cashback",requireAuth:!0,isMenuItem:!1}},{"bank-accounts":{compName:"bankaccounts-comp",title:e.menu_BankAccounts,url:"!/bank-accounts",requireAuth:!0,isMenuItem:!1}},{account:{compName:"account-comp",title:e.menu_Account,url:"!/account",requireAuth:!0,isMenuItem:!1}},{"account-information":{compName:"account-information-comp",title:e.menu_Account_Information,url:"!/account-information",requireAuth:!0,isMenuItem:!1}},{"credit-cards":{compName:"creditcard-comp",title:e.menu_CreditCard,url:"!/credit-cards",requireAuth:!0,isMenuItem:!1}},{"transaction-history":{compName:"transactionhistory-comp",title:e.menu_TransactionHistory,url:"!/transaction-history",requireAuth:!0,isMenuItem:!1}},{settings:{compName:"settings-comp",title:e.menu_Settings,url:"!/settings",requireAuth:!0,isMenuItem:!1}},{"commercial-account":{compName:"commercial-account-comp",title:e.menu_CommercialAccount,url:"!/commercial-account",requireAuth:!0,isMenuItem:!1}},{forgotpassword:{compName:"forgotpass-comp",title:"",url:"!/forgotpassword",requireAuth:!1,isMenuItem:!1}},{"change-password":{compName:"changepass-comp",title:"Şifre Değiştir",url:"!/change-password",requireAuth:!1,isMenuItem:!1}},{desk:{compName:"desk-comp",title:"Destek",url:"!/desk",requireAuth:!0,isMenuItem:!1}},{"faq-pages":{compName:"faq-pages-comp",title:"Yardım",url:"!/faq-pages",requireAuth:!0,isMenuItem:!1}},{split:{compName:"paparacard-split-comp",title:"Papara Card Bölüştür",url:"!/split",requireAuth:!1,isMenuItem:!1}}])},c.CheckResourceThenFillPages(),e(document).ajaxError(function(r,o,t,s){401===o.status?(i.remove("pUrl"),i.remove("fllName"),i.remove("fName"),e.removeCookie("auth-papara",{path:"/",domain:".papara.com"}),window.location.href="/personal/#!/login"):429===o.status?e("#toManyRequestErrorModal").modal():404===o.status?(console.log("["+o.status+"] - Requested page not found. - "+t.url),a.errorLb()):500===o.status?(console.log("["+o.status+"] - Internal Server Error. - "+t.url),a.errorLb()):"parsererror"===s?(console.log("Requested JSON parse failed. - "+t.url),a.errorLb()):"timeout"===s?(console.log("Time out error. - "+t.url),a.errorLb()):"abort"===s&&(console.log("Ajax request aborted. - "+t.url),a.errorLb())}),e("body").on("click",".clone",function(){"active"!==e(this).parent("li").attr("class")&&(e(".modal.in").hide().modal("hide"),e("body").removeClass("modal-open"),a.pageClone(),e(".clone").parent("li").removeClass("active")),e(this).parent("li").addClass("active")}),e.cookie("approvalinfoday")&&(e("#approvalinfoday").modal(),e("#usersApprovelInfoControl").html(String.format(c.Resources().usersApprovelInfoControl,e.cookie("approvalinfoday"))),setTimeout(function(){e("body").addClass("modal-open"),e.removeCookie("approvalinfoday")},100))})});